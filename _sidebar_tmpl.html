<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Gmail with Sidebar</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 13px;
    background: #f1f1f3;
    color: #18181b;
    min-height: 100vh;
  }

  .wrap { max-width: 1400px; margin: 0 auto; padding: 28px 24px; }

  .page-title {
    font-size: 17px;
    font-weight: 700;
    color: #09090b;
    margin-bottom: 20px;
    letter-spacing: -0.01em;
  }

  /* ── Two-column layout ── */
  .layout {
    display: flex;
    gap: 16px;
    align-items: flex-start;
  }

  /* ── Sidebar ── */
  .sidebar {
    width: 210px;
    flex-shrink: 0;
    background: #fff;
    border: 1px solid #e4e4e7;
    border-radius: 8px;
    overflow: hidden;
    position: sticky;
    top: 24px;
  }

  .sidebar-all {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    font-weight: 600;
    font-size: 12px;
    color: #27272a;
    cursor: pointer;
    border-bottom: 1px solid #e4e4e7;
    transition: background 0.1s;
    user-select: none;
  }
  .sidebar-all:hover { background: #fafafa; }
  .sidebar-all.active { background: #f4f4f5; }
  .sidebar-all-count { font-weight: 400; color: #a1a1aa; font-size: 11px; }

  .sidebar-section { border-bottom: 1px solid #f4f4f5; }
  .sidebar-section:last-child { border-bottom: none; }

  .sidebar-heading {
    padding: 8px 14px 4px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: #a1a1aa;
  }

  .sidebar-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 14px;
    cursor: pointer;
    border-radius: 0;
    transition: background 0.08s;
    user-select: none;
  }
  .sidebar-item:last-child { margin-bottom: 6px; }
  .sidebar-item:hover { background: #fafafa; }
  .sidebar-item.selected { background: #f4f4f5; font-weight: 600; }
  .sidebar-item.dimmed { opacity: 0.85; }
  .sidebar-item.disabled { opacity: 0.2; cursor: not-allowed; }
  .sidebar-item.disabled .sidebar-item-label { text-decoration: line-through; }
  .sidebar-item.disabled:hover { background: transparent; }

  .s-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  /* dot colors match pill backgrounds */
  .s-product    { background: #d4d4d8; }
  .s-audience   { background: #93c5fd; }
  .s-feature    { background: #6ee7b7; }
  .s-tofu       { background: #fde68a; }
  .s-bofu       { background: #c4b5fd; }
  .s-branded    { background: #86efac; }
  .s-competitor { background: #fca5a5; }

  .sidebar-item-label {
    flex: 1;
    font-size: 12px;
    color: #3f3f46;
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .sidebar-item.selected .sidebar-item-label { color: #09090b; }

  .sidebar-item-count {
    font-size: 11px;
    color: #a1a1aa;
    flex-shrink: 0;
    font-variant-numeric: tabular-nums;
  }
  .sidebar-item.selected .sidebar-item-count { color: #71717a; }

  /* ── Main content ── */
  .main { flex: 1; min-width: 0; }

  .main-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
    min-height: 24px;
  }
  .main-count {
    font-size: 11px;
    color: #a1a1aa;
  }
  .active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    flex: 1;
    margin: 0 12px;
  }
  .active-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px 2px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    line-height: 1.7;
    cursor: pointer;
  }
  .active-chip-x { font-size: 10px; opacity: 0.6; line-height: 1; }
  .active-chip:hover .active-chip-x { opacity: 1; }

  .clear-btn {
    padding: 3px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    color: #71717a;
    background: #f4f4f5;
    border: 1px solid #e4e4e7;
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
    display: none;
    flex-shrink: 0;
  }
  .clear-btn:hover { background: #e4e4e7; color: #27272a; }
  .clear-btn.visible { display: inline-block; }

  /* ── Table ── */
  .tbl-wrap {
    background: #fff;
    border: 1px solid #e4e4e7;
    border-radius: 8px;
    overflow: hidden;
  }
  table { width: 100%; border-collapse: collapse; table-layout: auto; }
  tbody tr { transition: background 0.08s; }
  tbody tr:hover { background: #fafafa; }
  tbody tr:not(:last-child) td { border-bottom: 1px solid #f4f4f5; }
  tbody tr.hidden { display: none; }

  td { padding: 9px 14px; vertical-align: middle; }
  td.num {
    width: 36px;
    text-align: right;
    color: #d4d4d8;
    font-size: 11px;
    font-variant-numeric: tabular-nums;
    padding-right: 8px;
    white-space: nowrap;
  }
  td.prompt { color: #27272a; line-height: 1.55; word-break: break-word; width: 99%; }
  td.tags { width: 1px; white-space: nowrap; padding-left: 8px; vertical-align: middle; }
  .tags-wrap { display: flex; gap: 4px; flex-wrap: nowrap; }

  /* ── No results ── */
  .no-results {
    display: none;
    padding: 32px;
    text-align: center;
    color: #a1a1aa;
    font-size: 13px;
  }
  .no-results.visible { display: block; }

  /* ── Pills ── */
  .pill {
    display: inline-block;
    padding: 2px 9px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    line-height: 1.7;
    white-space: nowrap;
    max-width: 240px;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }
  .p-product    { background: #f4f4f5; color: #52525b; }
  .p-audience   { background: #dbeafe; color: #1d4ed8; }
  .p-feature    { background: #d1fae5; color: #047857; }
  .p-other      { background: #f4f4f5; color: #52525b; }
  .p-tofu       { background: #fef9c3; color: #a16207; }
  .p-bofu       { background: #ede9fe; color: #6d28d9; }
  .p-branded    { background: #dcfce7; color: #15803d; }
  .p-competitor { background: #fee2e2; color: #b91c1c; }

  /* ── Inline highlights ── */
  mark.brand { background: #ecfdf6; color: #15803d; border-radius: 2px; padding: 0 2px; font-style: normal; }
  mark.comp  { background: #fef2f2; color: #dc2626; border-radius: 2px; padding: 0 2px; font-style: normal; }
</style>
</head>
<body>
<div class="wrap">
  <div class="page-title">Prompt Gmail with Sidebar</div>
  <div class="layout">
    <div class="sidebar" id="sidebar"></div>
    <div class="main">
      <div class="main-header">
        <span class="main-count" id="count"></span>
        <div class="active-filters" id="activeFilters"></div>
        <button class="clear-btn" id="clearBtn">Clear all</button>
      </div>
      <div class="tbl-wrap">
        <table><tbody id="tbody"></tbody></table>
        <div class="no-results" id="noResults">No prompts match the selected filters.</div>
      </div>
    </div>
  </div>
</div>

<script>
const DATA = /*DATA_PLACEHOLDER*/;

const BRAND = 'imagin';
const COMPS = ['Banco Santander', 'Vivid Money', 'Revolut', 'ABANCA', 'BBVA', 'Wise', 'N26', 'B100'];

// ── Sidebar group definitions (order matters) ────────────────────────────────
const GROUPS = [
  { name: 'Stage',    classes: ['p-tofu', 'p-bofu', 'p-branded', 'p-competitor'],
    dots:  { 'p-tofu': 's-tofu', 'p-bofu': 's-bofu', 'p-branded': 's-branded', 'p-competitor': 's-competitor' } },
  { name: 'Audience', classes: ['p-audience'], dots: { 'p-audience': 's-audience' } },
  { name: 'Feature',  classes: ['p-feature'],  dots: { 'p-feature': 's-feature' } },
  { name: 'Product',  classes: ['p-product', 'p-other'], dots: { 'p-product': 's-product', 'p-other': 's-product' } },
];

function esc(s) {
  return String(s)
    .replace(/&/g, '&amp;').replace(/</g, '&lt;')
    .replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}
function escRe(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

function highlight(text) {
  var s = esc(text);
  s = s.replace(new RegExp(escRe(BRAND), 'gi'),
    function(m) { return '<mark class="brand">' + m + '</mark>'; });
  COMPS.forEach(function(c) {
    s = s.replace(new RegExp(escRe(c), 'gi'),
      function(m) { return '<mark class="comp">' + m + '</mark>'; });
  });
  return s;
}

var GROUP_LABEL = {
  'p-tofu': 'Stage', 'p-bofu': 'Stage', 'p-branded': 'Stage', 'p-competitor': 'Stage',
  'p-audience': 'Audience', 'p-feature': 'Feature',
  'p-product': 'Product', 'p-other': 'Product'
};

function pill(t) {
  var prefix = GROUP_LABEL[t.c] ? GROUP_LABEL[t.c] + ': ' : '';
  return '<span class="pill ' + esc(t.c) + '" title="' + esc(prefix + t.v) + '">' + esc(t.v) + '</span>';
}

// ── Collect unique tags and counts ───────────────────────────────────────────
var tagMeta  = new Map(); // value → {v, c}
var tagCount = new Map(); // value → count
DATA.forEach(function(row) {
  row.tags.forEach(function(t) {
    if (!tagMeta.has(t.v)) tagMeta.set(t.v, t);
    tagCount.set(t.v, (tagCount.get(t.v) || 0) + 1);
  });
});

// ── Build table rows ─────────────────────────────────────────────────────────
document.getElementById('tbody').innerHTML = DATA.map(function(row, i) {
  var tagVals  = row.tags.map(function(t) { return t.v; }).join('|||');
  var tagPills = '<div class="tags-wrap">' + row.tags.map(pill).join('') + '</div>';
  return '<tr data-tags="' + esc(tagVals) + '">'
    + '<td class="num">' + (i + 1) + '</td>'
    + '<td class="prompt">' + highlight(row.prompt) + '</td>'
    + '<td class="tags">' + tagPills + '</td>'
    + '</tr>';
}).join('');

// ── Build sidebar ─────────────────────────────────────────────────────────────
var sidebarHTML = '<div class="sidebar-all" id="sidebarAll">'
  + '<span>All prompts</span>'
  + '<span class="sidebar-all-count">' + DATA.length + '</span>'
  + '</div>';

GROUPS.forEach(function(group) {
  var groupTags = [];
  tagMeta.forEach(function(t) {
    if (group.classes.indexOf(t.c) !== -1) groupTags.push(t);
  });
  if (groupTags.length === 0) return;

  sidebarHTML += '<div class="sidebar-section">'
    + '<div class="sidebar-heading">' + esc(group.name) + '</div>';

  groupTags.forEach(function(t) {
    var dot = group.dots[t.c] || 's-product';
    var cnt = tagCount.get(t.v) || 0;
    sidebarHTML += '<div class="sidebar-item" data-tag="' + esc(t.v) + '">'
      + '<span class="s-dot ' + dot + '"></span>'
      + '<span class="sidebar-item-label" title="' + esc(t.v) + '">' + esc(t.v) + '</span>'
      + '<span class="sidebar-item-count">' + cnt + '</span>'
      + '</div>';
  });

  sidebarHTML += '</div>';
});

document.getElementById('sidebar').innerHTML = sidebarHTML;

// ── Filter logic ─────────────────────────────────────────────────────────────
var active      = new Set();
var trows       = document.querySelectorAll('tbody tr');
var sidebarItems = document.querySelectorAll('.sidebar-item');
var clearBtn    = document.getElementById('clearBtn');
var noResults   = document.getElementById('noResults');
var countEl     = document.getElementById('count');
var filtersEl   = document.getElementById('activeFilters');
var allBtn      = document.getElementById('sidebarAll');

function wouldBeCount(tag) {
  var count = 0;
  trows.forEach(function(row) {
    var rowTags = row.dataset.tags.split('|||');
    if (Array.from(active).concat([tag]).every(function(f) { return rowTags.indexOf(f) !== -1; })) count++;
  });
  return count;
}

function applyFilters() {
  var anyActive = active.size > 0;
  clearBtn.classList.toggle('visible', anyActive);
  allBtn.classList.toggle('active', !anyActive);

  sidebarItems.forEach(function(item) {
    var isSelected = active.has(item.dataset.tag);
    var isDimmed = anyActive && !isSelected;
    item.classList.toggle('selected', isSelected);
    item.classList.toggle('dimmed', isDimmed);
    var cntEl = item.querySelector('.sidebar-item-count');
    if (cntEl) {
      if (isDimmed) {
        var wbc = wouldBeCount(item.dataset.tag);
        cntEl.textContent = wbc;
        item.classList.toggle('disabled', wbc === 0);
      } else {
        cntEl.textContent = tagCount.get(item.dataset.tag) || 0;
        item.classList.remove('disabled');
      }
    }
  });

  var visibleCount = 0;
  trows.forEach(function(row) {
    var rowTags = row.dataset.tags.split('|||');
    var show = !anyActive || Array.from(active).every(function(f) { return rowTags.indexOf(f) !== -1; });
    row.classList.toggle('hidden', !show);
    if (show) visibleCount++;
  });

  countEl.textContent = visibleCount + '\u200A' + (visibleCount === 1 ? 'prompt' : 'prompts');
  noResults.classList.toggle('visible', visibleCount === 0);

  // Active filter chips above the table
  filtersEl.innerHTML = Array.from(active).map(function(v) {
    var t = tagMeta.get(v);
    var cls = t ? t.c : 'p-other';
    return '<span class="active-chip ' + esc(cls) + '" data-tag="' + esc(v) + '">'
      + esc(v)
      + '<span class="active-chip-x">&#x2715;</span>'
      + '</span>';
  }).join('');

  // Re-wire chip click to remove
  filtersEl.querySelectorAll('.active-chip').forEach(function(chip) {
    chip.addEventListener('click', function() {
      active.delete(chip.dataset.tag);
      applyFilters();
    });
  });
}

sidebarItems.forEach(function(item) {
  item.addEventListener('click', function() {
    if (item.classList.contains('disabled')) return;
    if (active.has(item.dataset.tag)) { active.delete(item.dataset.tag); }
    else { active.add(item.dataset.tag); }
    applyFilters();
  });
});

allBtn.addEventListener('click', function() {
  active.clear();
  applyFilters();
});

clearBtn.addEventListener('click', function() {
  active.clear();
  applyFilters();
});

// Initial render
applyFilters();
</script>
</body>
</html>
