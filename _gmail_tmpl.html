<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Gmail</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 13px;
    background: #f1f1f3;
    color: #18181b;
    min-height: 100vh;
  }

  .wrap { max-width: 1280px; margin: 0 auto; padding: 28px 24px; }

  .page-title {
    font-size: 17px;
    font-weight: 700;
    color: #09090b;
    margin-bottom: 20px;
    letter-spacing: -0.01em;
  }

  /* ── Filter bar ── */
  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
    padding: 10px 14px;
    background: #fff;
    border: 1px solid #e4e4e7;
    border-radius: 8px;
    margin-bottom: 8px;
  }
  .filter-label {
    font-size: 11px;
    font-weight: 600;
    color: #a1a1aa;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-right: 2px;
    flex-shrink: 0;
  }
  .fp {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    line-height: 1.7;
    white-space: nowrap;
    cursor: pointer;
    border: 1.5px solid transparent;
    transition: opacity 0.12s, box-shadow 0.12s, border-color 0.12s;
    user-select: none;
  }
  .fp:hover { box-shadow: 0 0 0 2px rgba(0,0,0,0.10); }
  .fp.selected { border-color: #27272a; box-shadow: 0 0 0 1px #27272a; }
  .fp.dimmed { opacity: 0.85; }
  .fp-count { display: none; margin-left: 3px; font-size: 10px; opacity: 0.75; }
  .fp.dimmed .fp-count { display: inline; }
  .fp.disabled { opacity: 0.15; cursor: not-allowed; text-decoration: line-through; }
  .fp.disabled:hover { box-shadow: none; }

  .filter-count {
    font-size: 11px;
    color: #a1a1aa;
    flex-shrink: 0;
    margin-left: 4px;
  }

  .clear-btn {
    margin-left: auto;
    padding: 3px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    color: #71717a;
    background: #f4f4f5;
    border: 1px solid #e4e4e7;
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
    display: none;
    flex-shrink: 0;
  }
  .clear-btn:hover { background: #e4e4e7; color: #27272a; }
  .clear-btn.visible { display: inline-block; }

  /* ── Table ── */
  .tbl-wrap {
    background: #fff;
    border: 1px solid #e4e4e7;
    border-radius: 8px;
    overflow: hidden;
  }
  table { width: 100%; border-collapse: collapse; table-layout: auto; }
  tbody tr { transition: background 0.08s; }
  tbody tr:hover { background: #fafafa; }
  tbody tr:not(:last-child) td { border-bottom: 1px solid #f4f4f5; }
  tbody tr.hidden { display: none; }

  td { padding: 9px 14px; vertical-align: middle; }
  td.num {
    width: 36px;
    text-align: right;
    color: #d4d4d8;
    font-size: 11px;
    font-variant-numeric: tabular-nums;
    padding-right: 8px;
    white-space: nowrap;
  }
  td.prompt { color: #27272a; line-height: 1.55; word-break: break-word; width: 99%; }
  td.tags { width: 1px; white-space: nowrap; padding-left: 8px; vertical-align: middle; }
  .tags-wrap { display: flex; gap: 4px; flex-wrap: nowrap; }

  /* ── No results ── */
  .no-results {
    display: none;
    padding: 32px;
    text-align: center;
    color: #a1a1aa;
    font-size: 13px;
  }
  .no-results.visible { display: block; }

  /* ── Pills ── */
  .pill {
    display: inline-block;
    padding: 2px 9px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 500;
    line-height: 1.7;
    white-space: nowrap;
    max-width: 240px;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }
  .p-product    { background: #f4f4f5; color: #52525b; }
  .p-audience   { background: #dbeafe; color: #1d4ed8; }
  .p-feature    { background: #d1fae5; color: #047857; }
  .p-other      { background: #f4f4f5; color: #52525b; }
  .p-tofu       { background: #fef9c3; color: #a16207; }
  .p-bofu       { background: #ede9fe; color: #6d28d9; }
  .p-branded    { background: #ffedd5; color: #c2410c; }
  .p-competitor { background: #fee2e2; color: #b91c1c; }

  /* ── Inline highlights ── */
  mark.brand { background: #fff7ed; color: #c2410c; border-radius: 2px; padding: 0 2px; font-style: normal; }
  mark.comp  { background: #fef2f2; color: #dc2626; border-radius: 2px; padding: 0 2px; font-style: normal; }
</style>
</head>
<body>
<div class="wrap">
  <div class="page-title">Prompt Gmail</div>
  <div id="main"></div>
</div>

<script>
const DATA = /*DATA_PLACEHOLDER*/;

const BRAND = 'imagin';
const COMPS = ['Banco Santander', 'Vivid Money', 'Revolut', 'ABANCA', 'BBVA', 'Wise', 'N26', 'B100'];

function esc(s) {
  return String(s)
    .replace(/&/g, '&amp;').replace(/</g, '&lt;')
    .replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function escRe(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

function highlight(text) {
  var s = esc(text);
  s = s.replace(new RegExp(escRe(BRAND), 'gi'),
    function(m) { return '<mark class="brand">' + m + '</mark>'; });
  COMPS.forEach(function(c) {
    s = s.replace(new RegExp(escRe(c), 'gi'),
      function(m) { return '<mark class="comp">' + m + '</mark>'; });
  });
  return s;
}

var GROUP_LABEL = {
  'p-tofu': 'Stage', 'p-bofu': 'Stage', 'p-branded': 'Stage', 'p-competitor': 'Stage',
  'p-audience': 'Audience', 'p-feature': 'Feature',
  'p-product': 'Product', 'p-other': 'Product'
};

function pill(t) {
  var prefix = GROUP_LABEL[t.c] ? GROUP_LABEL[t.c] + ': ' : '';
  return '<span class="pill ' + esc(t.c) + '" title="' + esc(prefix + t.v) + '">' + esc(t.v) + '</span>';
}

// Collect unique tags across all rows, in order of first appearance
var seen = new Map();
DATA.forEach(function(row) {
  row.tags.forEach(function(t) {
    if (!seen.has(t.v)) seen.set(t.v, t);
  });
});
var uniqueTags = Array.from(seen.values());

var filterPills = uniqueTags.map(function(t) {
  return '<span class="fp ' + esc(t.c) + '" data-tag="' + esc(t.v) + '">' + esc(t.v) + '<span class="fp-count"></span></span>';
}).join('');

var tableRows = DATA.map(function(row, i) {
  var tagVals = row.tags.map(function(t) { return t.v; }).join('|||');
  var tagPills = '<div class="tags-wrap">' + row.tags.map(pill).join('') + '</div>';
  return '<tr data-tags="' + esc(tagVals) + '">'
    + '<td class="num">' + (i + 1) + '</td>'
    + '<td class="prompt">' + highlight(row.prompt) + '</td>'
    + '<td class="tags">' + tagPills + '</td>'
    + '</tr>';
}).join('');

document.getElementById('main').innerHTML =
  '<div class="filter-bar">'
  + '<span class="filter-label">Filter</span>'
  + filterPills
  + '<span class="filter-count" id="count">' + DATA.length + '&thinsp;prompts</span>'
  + '<button class="clear-btn" id="clearBtn">Clear</button>'
  + '</div>'
  + '<div class="tbl-wrap"><table><tbody>' + tableRows + '</tbody></table>'
  + '<div class="no-results" id="noResults">No prompts match the selected filters.</div>'
  + '</div>';

// Filter logic
var active     = new Set();
var fps        = document.querySelectorAll('.fp');
var rows       = document.querySelectorAll('tbody tr');
var clearBtn   = document.getElementById('clearBtn');
var noResults  = document.getElementById('noResults');
var countEl    = document.getElementById('count');

function wouldBeCount(tag) {
  var count = 0;
  rows.forEach(function(row) {
    var rowTags = row.dataset.tags.split('|||');
    if (Array.from(active).concat([tag]).every(function(f) { return rowTags.indexOf(f) !== -1; })) count++;
  });
  return count;
}

function applyFilters() {
  var anyActive = active.size > 0;
  clearBtn.classList.toggle('visible', anyActive);

  fps.forEach(function(fp) {
    var isSelected = active.has(fp.dataset.tag);
    var isDimmed = anyActive && !isSelected;
    fp.classList.toggle('selected', isSelected);
    fp.classList.toggle('dimmed', isDimmed);
    var fpCount = fp.querySelector('.fp-count');
    if (isDimmed) {
      var wbc = wouldBeCount(fp.dataset.tag);
      fpCount.textContent = wbc;
      fp.classList.toggle('disabled', wbc === 0);
    } else {
      fpCount.textContent = '';
      fp.classList.remove('disabled');
    }
  });

  var visibleCount = 0;
  rows.forEach(function(row) {
    var rowTags = row.dataset.tags.split('|||');
    var show = !anyActive || Array.from(active).every(function(f) { return rowTags.indexOf(f) !== -1; });
    row.classList.toggle('hidden', !show);
    if (show) visibleCount++;
  });

  countEl.textContent = visibleCount + '\u200Aprompts';
  noResults.classList.toggle('visible', visibleCount === 0);
}

fps.forEach(function(fp) {
  fp.addEventListener('click', function() {
    if (fp.classList.contains('disabled')) return;
    if (active.has(fp.dataset.tag)) { active.delete(fp.dataset.tag); }
    else { active.add(fp.dataset.tag); }
    applyFilters();
  });
});

clearBtn.addEventListener('click', function() {
  active.clear();
  applyFilters();
});
</script>
</body>
</html>
